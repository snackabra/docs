<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Technical Overview" href="overview.html" /><link rel="prev" title="Snackabra" href="index.html" />

    <meta name="generator" content="sphinx-5.1.1, furo 2022.09.29"/>
        <title>Introduction - snackabra 0.5.0 alpha documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">snackabra 0.5.0 alpha documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">snackabra 0.5.0 alpha documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Technical Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="system-architecture.html">System Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="discussion.html">Background and Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="formal.html">Formal Treatment</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact and Feedback</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="future.html">Future Work</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References / Further Reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">LICENSE</a></li>
<li class="toctree-l1"><a class="reference internal" href="jslib.html">Javascript Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="pylib.html">Python Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-a-crypto.html">Appendix A: Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-guide.html">Appendix B: Privacy.App Chat Room User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="diag-sample.html">(ignore)</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="introduction">
<span id="id1"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h1>
<p>One-to-one messaging or group messaging is the same in snackabra,
everything centers around a “room”. You access a room with it’s unique
URL, that will look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">hkUkHY6wm</span><span class="o">-</span><span class="n">ZXmIyhCt1v4NBK</span><span class="o">-</span><span class="n">o1PV4GyKBnl7U8KaYgoe1Yi150ptDnVUmkboFOL</span>
</pre></div>
</div>
<p>First time you visit any room you will see a welcome message to assign yourself an alias:</p>
<figure class="align-default" id="id6" style="width: 40%">
<a class="reference external image-reference" href="_static/welcome-message.png"><img alt="_images/welcome-message.png" src="_images/welcome-message.png" /></a>
<figcaption>
<p><span class="caption-text">Typical first-time-visitor message.</span><a class="headerlink" href="#id6" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Type something in the box, and you’re in the chat room:</p>
<figure class="align-default" id="id7" style="width: 40%">
<a class="reference external image-reference" href="_static/sample-room.png"><img alt="_images/sample-room.png" src="_images/sample-room.png" /></a>
<figcaption>
<p><span class="caption-text">Sample view of a room.</span><a class="headerlink" href="#id7" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The above is from our current web interface, a native iOS app is under
development, but the “web app” interface is designed to work
(decently) on mobile browsers. <a class="footnote-reference brackets" href="#f06" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p>
<section id="message-types">
<h2>Message Types<a class="headerlink" href="#message-types" title="Permalink to this heading">#</a></h2>
<p>In the <a class="reference external" href="_static/sample-room.png">above screenshot</a> of a sample room,
all the main message types are demonstrated:</p>
<ul class="simple">
<li><p>Purple border (glimpsed at the top) indicates a Verified guest.
“Verified” guest means that this was the first visitor to enter
the room, other than the owner/Admin. If you’ve been invited
by an Owner to join their room for a one-to-one communication,
then you will be labelled as Verified.</p></li>
<li><p>Green border means Owner or Admin. All rooms have an Owner.
An Owner can be present in the room in different ways, incognitor
as a Guest, or as an Owner. “Admin” simply means the Owner
has logged in with full authentication, which is required for
certain Owner actions.</p></li>
<li><p>No border means regular Guest.</p></li>
<li><p>Yellow filled bubbles are “Whispers”.</p></li>
</ul>
<p>Your messages are shown on the right, and everybody else’s on the left.</p>
<p>Right away on entering a room you might note some important things:</p>
<ul class="simple">
<li><p>You’re not required to register, log in, pick a password.</p></li>
</ul>
</section>
<section id="room-keys">
<h2>Room Keys<a class="headerlink" href="#room-keys" title="Permalink to this heading">#</a></h2>
<p>A lot happened in your browser in the above simple steps. The snackabra web client
loaded, and checked for any state in your “local storage” (in your browser). If there’s none,
it initializes that data for you. You can see the results by selecting the “Home” tab:</p>
<figure class="align-default" id="id8" style="width: 40%">
<a class="reference external image-reference" href="_static/sample-home-page-fixed.png"><img alt="_images/sample-home-page-fixed.png" src="_images/sample-home-page-fixed.png" /></a>
<figcaption>
<p><span class="caption-text">Sample view of a basic home page.</span><a class="headerlink" href="#id8" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>If this is your first time using any snackabra chat rooms, you should
see something very similar to the above. It shows a link to the one room
that you’ve visited so far (“Room 1”), and amongst other things, gives you
an option to export or import your “keys”. We’ve expanded the text box a bit
so you can see the full set of “keys”. Let’s talk about those a bit.</p>
<p>When you first try to enter the room, you are just a “Visitor”, and behind
the scenes the snackabra web app will initialize local data with basics
about the room you’re trying to connect to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;roomData&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;contacts&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;roomMetadata&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;hkUkHY6wm-ZXmIyhCt1v4NBK-o1PV4GyKBnl7U8KaYgoe1Yi150ptDnVUmkboFOL&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Room 1&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is all that snackabra knows about you so far - that you’re trying
to access a room with identy <code class="docutils literal notranslate"><span class="pre">hkUkHY6wm...</span></code>. You haven’t “entered”
the room yet - the room requires your alias string before admitting
you.</p>
<p>At this point you’re a “visitor” and at first the system doesn’t know
anything about you.  Visitors are either Guests or Owners. Guests can
be Verified (or not), and Accepted (or not), and Owners can also be
Admin. More on all this shortly:</p>
<figure class="align-center" id="id9">
digraph visitors{
        size=&quot;6,6&quot;;
    node [shape=&quot;record&quot;, color=lightgrey]; Guest;
        node [color=lightblue2, style=filled];  Visitor; Owner; Admin
        &quot;Visitor&quot; -&gt; Guest;
        &quot;Visitor&quot; -&gt; &quot;Owner&quot; [label=&quot;  Keys Match Room?  &quot;, fontsize=&quot;10&quot;];
        &quot;Owner&quot; -&gt; &quot;Admin&quot; [label=&quot;  Cookie Present?  &quot;, fontsize=&quot;10&quot;];
    Guest [label=&quot;Guest: \n|{Verified?|Accepted?}&quot;];
}<figcaption>
<p><span class="caption-text">Basic categories of visitors</span><a class="headerlink" href="#id9" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>A typical first-time visitor is a straight-up Guest (neither Verified
nor Accepted).  The app now generates more state, which is what you
actually see when you go to the Home tab:<a class="footnote-reference brackets" href="#f05" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;roomData&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;hkUkHY6wm-ZXmIyhCt1v4NBK-o1PV4GyKBnl7U8KaYgoe1Yi150ptDnVUmkboFOL&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;crv&quot;</span><span class="p">:</span><span class="s2">&quot;P-384&quot;</span><span class="p">,</span>
              <span class="s2">&quot;d&quot;</span><span class="p">:</span><span class="s2">&quot;sj2_C2fkHLBp57X5MLJq6pN_ZErq0zZb8y4FvIXG_ffQsvqRlR958MMBcNwpzcn-&quot;</span><span class="p">,</span>
              <span class="s2">&quot;ext&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span>
              <span class="s2">&quot;key_ops&quot;</span><span class="p">:[</span><span class="s2">&quot;deriveKey&quot;</span><span class="p">],</span>
              <span class="s2">&quot;kty&quot;</span><span class="p">:</span><span class="s2">&quot;EC&quot;</span><span class="p">,</span>
              <span class="s2">&quot;x&quot;</span><span class="p">:</span><span class="s2">&quot;ql6o3O_8IC5fE7RnZOwTZtYm6Lm4oLyr3MgjH_gUIcZa1Y-PPhInxzfJxMNLQQqi&quot;</span><span class="p">,</span>
              <span class="s2">&quot;y&quot;</span><span class="p">:</span><span class="s2">&quot;YMKC8rqt6VmwyMNo70wiAJi8bPzIrGoNeIUEzShj6MJuRUYnZlG0dRjBHY9TPgeN&quot;</span>
             <span class="p">},</span>
      <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;Design Doc&quot;</span><span class="p">,</span>
      <span class="s2">&quot;lastSeenMessage&quot;</span><span class="p">:</span> <span class="s2">&quot;010111111001111001100100100000000100010000&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;contacts&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;OnjiCyxa5G68wlCvXbpI_gdXV2YN26z-Jju9bg7eGBz4G5uCKOeJMQSFvI8m1qYa NdCa_mJYUcfgghMwLE2YPtEdv7PBDcy2gW_aHB8zHv1_LFe9SMVOu5wooTQOWIKr&quot;</span><span class="p">:</span> <span class="s2">&quot;Unnamed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;T8tsnKkhqCx68KxDRYJt58w_dw_lAXjgr8I1RanxIV0M_quLX1sXdfbxR7wjLVSu lQD3521v2K4XAwo2uB0qMQR2uqZJcoAR0uyY8YSuVYGHC_qumpFleAB3I1t1dWrc&quot;</span><span class="p">:</span> <span class="s2">&quot;Unnamed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mMixQMasdGKMdqnxxzHbALZ95jIRBrZK-am_wEWfjNK1umaRW-Efd5tIV1Yr6Or9 PqDPj8NahdEnJbmFuuudwC57GR3UiljzHMP-4a64L7RTBaiMehJluyhuVjiOklJ8&quot;</span><span class="p">:</span> <span class="s2">&quot;Unnamed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;uO_6YnK55FecnIdEDrs5IDdyadc2Nrp9wFK3Te_ddoghrCljwA7acIRI28ZzGbq_ 7OdkqJhZgwgsZYIuFawl33hVqeems-D0aOZTLWjRC5WWKlSMDYA3Z2W68c_6-SJU&quot;</span><span class="p">:</span> <span class="s2">&quot;Unnamed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ql6o3O_8IC5fE7RnZOwTZtYm6Lm4oLyr3MgjH_gUIcZa1Y-PPhInxzfJxMNLQQqi YMKC8rqt6VmwyMNo70wiAJi8bPzIrGoNeIUEzShj6MJuRUYnZlG0dRjBHY9TPgeN&quot;</span><span class="p">:</span> <span class="s2">&quot;Me&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;roomMetadata&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;hkUkHY6wm-ZXmIyhCt1v4NBK-o1PV4GyKBnl7U8KaYgoe1Yi150ptDnVUmkboFOL&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Room 1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;lastMessageTime&quot;</span><span class="p">:</span> <span class="s2">&quot;010111110001001100010000011111000101101101&quot;</span><span class="p">,</span>
      <span class="s2">&quot;unread&quot;</span><span class="p">:</span> <span class="n">true</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These are your “keys”. We will explain the components briefly in this
overview, and then in detail elsewhere in the document. These are all
stored in your browser’s <code class="docutils literal notranslate"><span class="pre">localStorage</span></code> <a class="footnote-reference brackets" href="#f07" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>. That’s a small
database handled by your browser, whether you are on a computer or on
a mobile phone.</p>
<p>This is important: <strong>you are responsible for not losing these
keys</strong>. You can hit the “Export” button on your Home tab, and save
them as a file - on your phone or your computer, or email them to
yourself. If you are using a mobile app, then you won’t necessarily
see this data at all and the app will manage it for you on your
device. More on this later.</p>
</section>
<section id="sequence-diagrams">
<h2>Sequence Diagrams<a class="headerlink" href="#sequence-diagrams" title="Permalink to this heading">#</a></h2>
<p>First let’s introduce the type of sequence diagrams that we will be
using in these docs:</p>
<div class="align-default"><img height="735" src="_images/seqdiag-ebf5236af8edb72b009d08d1d510e8aae8b29842.png" width="856" /></div>
<p>Note that the “solid” arrowhead is something initated, and if there
is a regular arrow immediately after then, that is the reply.
If the line is dotted, it’s optional - an optional reply, or
an event that “might” happen.</p>
</section>
<section id="basic-connection">
<h2>Basic Connection<a class="headerlink" href="#basic-connection" title="Permalink to this heading">#</a></h2>
<p>Here’s roughly what’s going on. Let’s say you’re connecting to
“example.com/&lt;room…&gt;” with a browser (on a computer or on a phone,
doesn’t matter, you’re using a “web client” / “web app”):</p>
<div class="align-default"><img height="897" src="_images/seqdiag-6770fdb2caf10830b6beff0d8302621b80e310de.png" width="640" /></div>
<p>Details on the steps:</p>
<ol class="arabic simple">
<li><p>Your browser connects to “&lt;site&gt;/&lt;roomId&gt;”, which returns
the web application (for example <a class="reference external" href="https://github.com/snackabra/snackabra-weblient">https://github.com/snackabra/snackabra-weblient</a>).
The client logic is the downloaded web app. This step is optional - if
you are running your web client locally, or using a mobile app
(for example <a class="reference external" href="https://github.com/snackabra/snackabra-ios">https://github.com/snackabra/snackabra-ios</a>), then
your interaction goes to the next step. For this example we’ll
assume you’re using a browser.</p></li>
<li><p>Web client (“app”) fires up.</p></li>
<li><p>The app checks for crypto keys in the browsers’
local storage, and will load what’s there. If that includes
keys for the room in question, then it’ll use those,
otherwise it will generate a new “personal public key”
pair (and store it locally). That’s your “real” identity in any room.</p></li>
<li><p>The app connects (web socket) to the room server. In this example
we will assume you’re connecting to a <a class="reference internal" href="glossary.html#term-Personal-Room-Server"><span class="xref std std-term">Personal Room Server</span></a>
to keep it simple.</p></li>
<li><p>The first thing the app does is present the user identity (the
public key from [3]).</p></li>
<li><p>The room server will respond with a number of things:
the room keys (public keys for other participants),
the <a class="reference internal" href="glossary.html#term-MOTD"><span class="xref std std-term">MOTD</span></a>, and whether the room is <a class="reference internal" href="glossary.html#term-Restricted"><span class="xref std std-term">Restricted</span></a> or not.</p></li>
<li><p>Once the app has digested all the info and is all set
to rock and roll, it sends a “ready” message to the room server.</p></li>
<li><p>The first thing the room sends upon seeing “ready” is to
start catching the client up on messages (latest 100).</p></li>
<li><p>As long as the socket is open, the room server will forward
anything anybody else adds to the room, in real time.</p></li>
</ol>
<p>Now we can connect that back to the state in the previous figure (the
“[N]” notation refers to explanations below the figure):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">{</span>

      <span class="s2">&quot;roomData&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span>       <span class="s2">&quot;hkUkHY6wm-ZXmIyhCt1v4NBK-o1PV4GyKBn...</span>
          <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;crv&quot;</span><span class="p">:</span><span class="s2">&quot;P-384&quot;</span><span class="p">,</span>
<span class="p">[</span><span class="mi">3</span><span class="p">]</span>               <span class="s2">&quot;d&quot;</span><span class="p">:</span><span class="s2">&quot;sj2_C2fkHLBp57X5MLJq6pN...</span>
                  <span class="s2">&quot;ext&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span>
                  <span class="s2">&quot;key_ops&quot;</span><span class="p">:[</span><span class="s2">&quot;deriveKey&quot;</span><span class="p">],</span>
                  <span class="s2">&quot;kty&quot;</span><span class="p">:</span><span class="s2">&quot;EC&quot;</span><span class="p">,</span>
<span class="p">[</span><span class="mi">4</span><span class="p">]</span>               <span class="s2">&quot;x&quot;</span><span class="p">:</span><span class="s2">&quot;ql6o3O_8IC5fE7RnZOwTZtY...</span>
                  <span class="s2">&quot;y&quot;</span><span class="p">:</span><span class="s2">&quot;YMKC8rqt6VmwyMNo70wiAJi...</span>
                 <span class="p">},</span>
          <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;Design Doc&quot;</span><span class="p">,</span>
          <span class="s2">&quot;lastSeenMessage&quot;</span><span class="p">:</span> <span class="s2">&quot;0101111110011110...</span>
        <span class="p">}</span>
      <span class="p">},</span>
<span class="p">[</span><span class="mi">5</span><span class="p">]</span>   <span class="s2">&quot;contacts&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;OnjiCyxa5G68wlCvXbpI_gdXV2YN26z-Jju9b...</span>
        <span class="s2">&quot;T8tsnKkhqCx68KxDRYJt58w_dw_lAXjgr8I1R...</span>
        <span class="s2">&quot;mMixQMasdGKMdqnxxzHbALZ95jIRBrZK-am_w...</span>
        <span class="s2">&quot;uO_6YnK55FecnIdEDrs5IDdyadc2Nrp9wFK3T...</span>
<span class="p">[</span><span class="mi">6</span><span class="p">]</span>     <span class="s2">&quot;ql6o3O_8IC5FE7RnZ0wTztYM6Lm4oLyr3MgjH...</span>
      <span class="p">},</span>
      <span class="s2">&quot;roomMetadata&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hkUkHY6wm-ZXmIyhCt1v4NBK-o1PV4GyKBnl7...</span>
<span class="p">[</span><span class="mi">7</span><span class="p">]</span>       <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Room 1&quot;</span><span class="p">,</span>
<span class="p">[</span><span class="mi">8</span><span class="p">]</span>       <span class="s2">&quot;lastMessageTime&quot;</span><span class="p">:</span> <span class="s2">&quot;0101111100010011...</span>
          <span class="s2">&quot;unread&quot;</span><span class="p">:</span> <span class="n">true</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>All this type of information we tend to call “keys”, even if
there’s also some meta data. They’re stored in JSON format
in local browser storage (or secure storage on a mobile app).</p></li>
<li><p>You recognize the room id by now!</p></li>
<li><p>“d” is magical in EC keys, it’s the “private” part of the key.
This thus keeps your local (secret) private key that corresponds
to this specific room. All participants get all the public
keys from all other participants.</p></li>
<li><p>The “x,y” pair is your public key (so to speak).</p></li>
<li><p>The “contacts” section simply lists the identities of everybody
else on the chat. The room server tracks this.</p></li>
<li><p>And here “we” are, in the list of participants.</p></li>
<li><p>For ease of (human) use, the client tracks some meta data on the
room. For example you can assign it a name (only visible to
yourself).</p></li>
<li><p>This shows the time stamp of the last seen message.
We use a time stamp representation that allows for prefix
searches, more on this later.</p></li>
</ol>
<p>It’s an important design principle of snackabra that the important
pieces of information is comprehensible, and accessible, to users.
Nothing (important) hidden inside some compiled application, or on
some server.</p>
<p>To reiterate the important bits:</p>
<ul class="simple">
<li><p>There is <em>no global identity</em> for any users. Your identity is
always <em>relative</em> to a room.</p></li>
<li><p>Rooms are essentially <em>independent of servers</em>. A “room”
is made up of the set of keys that define the participants,
and the (encrypted) messages that have accrued thus far.</p></li>
<li><p>(Strong) public key cryptography is used throughout to directly
represent “identities”. The public half is visible to various participants
and servers, globally identifying either a room, or a
participant within a room.</p></li>
<li><p>The only authentication ever needed is the private half
of a corresponding key.</p></li>
</ul>
<p>You might be asking how we authenticate the room itself? Good question.
It’s derived from the “owner key”, namely, the (public) key generated
for the “root” participant of the room. When a room is created, what
is actually created is a new personal public key; the room name is
simply derived from this (details later). That means only the individual
with the private half of the owner key can ever prove that they “own”
the room. When rooms are migrated or mirrored, snackabra servers will
only accept the authority provided by that owner, and snackabra clients
can verify that the servers are doing it correctly. <a class="footnote-reference brackets" href="#f08" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a></p>
<p>This is the gist of it. The biggest part that we’re not covering in
this overview is storage - how to share photos and files and
documents, while maintaining privacy, secrecy, etc, is the big
“pillar” of snackabra.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<hr class="docutils" />
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f05" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">1</a><span class="fn-bracket">]</span></span>
<p>Here we are cleaning it up a little so it’s easier to read, the actual
string will have some escape characters etc so that it can be stored
and re-loaded and re-parsed.</p>
</aside>
<aside class="footnote brackets" id="f06" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>It’s important to note that this is just our reference web app user
interface - the important parts of snackabra are various protocols and
formats, hopefully allowing anybody that wants to develop their own
apps (or add chat features to web sites or apps) to take their own
approach.</p>
</aside>
<aside class="footnote brackets" id="f07" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">3</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage">https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage</a></p>
</aside>
<aside class="footnote brackets" id="f08" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">4</a><span class="fn-bracket">]</span></span>
<p>Regardless, it’s not very useful to spoof ownership, since
unless you were a participant, you can’t untangle and read
the message history anyway.</p>
</aside>
</aside>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="overview.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Technical Overview</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2019-2022, Magnusson Institute
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Introduction</a><ul>
<li><a class="reference internal" href="#message-types">Message Types</a></li>
<li><a class="reference internal" href="#room-keys">Room Keys</a></li>
<li><a class="reference internal" href="#sequence-diagrams">Sequence Diagrams</a></li>
<li><a class="reference internal" href="#basic-connection">Basic Connection</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    </body>
</html>