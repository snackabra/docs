<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="JSLib Reference Manual" href="modules.html" /><link rel="prev" title="LICENSE" href="license.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>JSLib User Manual - snackabra 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">snackabra 1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">snackabra 1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Technical Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="system-architecture.html">System Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="discussion.html">Background and Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="formal.html">Formal Treatment</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact and Feedback</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="future.html">Future Work</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References / Further Reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">LICENSE</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">JSLib User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">JSLib Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Snackabra Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="pylib.html">Python Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-a-crypto.html">Appendix A: Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-guide.html">Appendix B: Privacy.App Chat Room User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="diag-sample.html">(ignore)</a></li>
<li class="toctree-l1"><a class="reference internal" href="motivation.html">Motivation</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="jslib-user-manual">
<h1>JSLib User Manual<a class="headerlink" href="#jslib-user-manual" title="Permalink to this heading">#</a></h1>
<p><em>The core of SB is implemented in snackabra.ts, targeting ES2022.
This section documents the JS (translated) version. Please note:
any current published version is Alpha of upcoming 0.5.0 and should
not be used for sensitive or production use (or if you do use it as
such: caveat emptor). We will signal production-ready use by versioning
it as 1.0.x (published to npmjs).</em></p>
<p><em>We are still trying to sort out how to get Sphinx, JSDoc, Typedoc,
etc to all play nice together in a good way…</em></p>
<p>All core capababilities of the SB design is intended to be encapsulated
in this library. Design objectives include: <a class="footnote-reference brackets" href="#id6" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p>
<ul class="simple">
<li><p>No external dependencies (no other libraries)</p></li>
<li><p>No dependencies on the DOM object</p></li>
<li><p>Pure asynchronous (eg no ‘await’)</p></li>
<li><p>Clean es2022 code</p></li>
<li><p>Zero errors/warnings on tsc ‘strict’ setting</p></li>
<li><p>Minimum “forced typecasting”</p></li>
<li><p>DRY extendable / abstract OOP implementation</p></li>
</ul>
<section id="installation-development">
<h2>Installation / Development<a class="headerlink" href="#installation-development" title="Permalink to this heading">#</a></h2>
<p>Install with:</p>
<p><code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">i</span> <span class="pre">-g</span> <span class="pre">snackabra</span></code></p>
<p>Git repository: <a class="reference external" href="https://github.com/snackabra/snackabra-jslib.git">https://github.com/snackabra/snackabra-jslib.git</a></p>
<p>Note: in SB version 0.5.0, most core SB client and server
logic is being refactored into this library. If you’re looking
at this prior to release of 0.5.0 (link above), then the latest
(in progress) version underlying this documentation is here:</p>
<p><a class="reference external" href="https://github.com/384co/snackabra-docs/blob/main/snackabra-jslib/snackabra.js">https://github.com/384co/snackabra-docs/blob/main/snackabra-jslib/snackabra.js</a></p>
<p>Complete reference is here:</p>
<ul class="simple">
<li><p><a class="reference external" href="modules.html">JSLib</a></p></li>
</ul>
</section>
<section id="sb384">
<h2>SB384<a class="headerlink" href="#sb384" title="Permalink to this heading">#</a></h2>
<p>Most classes in SB are rooted in SB384. It encapsulates the core of an
“identifier” in SB, namely a (384-bit) global <a class="reference internal" href="glossary.html#term-channel-name"><span class="xref std std-term">Channel Name</span></a>, derived
from the <a class="reference internal" href="glossary.html#term-Owner-Key"><span class="xref std std-term">Owner Key</span></a> of that object - typically either a <a class="reference internal" href="glossary.html#term-channel"><span class="xref std std-term">channel</span></a>
or a <a class="reference internal" href="glossary.html#term-object"><span class="xref std std-term">object</span></a>. Most of the properties (see getters below) are various
perspectives and formats on this identity.</p>
<ul class="simple">
<li><p><a class="reference external" href="classes/SB384.html">SB384</a></p></li>
</ul>
</section>
<section id="snackabra-server-class">
<h2>Snackabra (Server) Class<a class="headerlink" href="#snackabra-server-class" title="Permalink to this heading">#</a></h2>
<p id="snackabra">The SB class is the orchestrator, in particular it tracks one or more channels
connecting to one or more SB servers.</p>
<ul class="simple">
<li><p><a class="reference external" href="classes/Snackabra.html">Snackabra</a></p></li>
<li><p><a class="reference external" href="interfaces/SBServer.html">SBServer</a></p></li>
</ul>
<p>Sample usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> const SB = new Snackabra(sb_config)
 SB.create(
   &#39;password&#39;,
   (new Identity())).then((channelId) =&gt; {
     SB.connect(
       channelId,
       (m: ChannelMessage) =&gt; { console.log(`got message: ${m}`)}
     ).then((c) =&gt; c.ready).then((c) =&gt; {
       c.userName = &quot;TestBot&quot; // optional
       (new SBMessage(c, &quot;Hello Message!&quot;)).send().then((c) =&gt; { console.log(`sent! (${c})`) })
    })
  })
}
</pre></div>
</div>
<section id="sb-message-class">
<h3>SB Message Class<a class="headerlink" href="#sb-message-class" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="classes/SBMessage.html">SBMessage</a></p></li>
</ul>
</section>
<section id="channels">
<h3>Channels<a class="headerlink" href="#channels" title="Permalink to this heading">#</a></h3>
<p>Channels (aka “Rooms”) are the core communication primitive in SB.
Channel “sockets” are the synchronous communication interface to channels.
The channel “API” class is the asynchronous interface to channels.</p>
<ul class="simple">
<li><p><a class="reference external" href="classes/Channel.html">Channel</a></p></li>
<li><p><a class="reference external" href="interfaces/SBChannelHandle.html">SBChannelHandle</a></p></li>
<li><p><a class="reference external" href="classes/ChannelSocket.html">ChannelSocket</a></p></li>
<li><p><a class="reference external" href="interfaces/ChannelKeys.html">ChannelKeys</a></p></li>
<li><p><a class="reference external" href="interfaces/ChannelMessage.html">ChannelMessage</a></p></li>
</ul>
</section>
<section id="storage">
<h3>Storage<a class="headerlink" href="#storage" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="interfaces/SBObjectHandle.html">SBObjectHandle</a></p></li>
<li><p><a class="reference external" href="classes/SBObjectHandleClass.html">SBObjectHandleClass</a></p></li>
<li><p><a class="reference external" href="interfaces/SBObjectMetadata.html">SBObjectMetadata</a></p></li>
<li><p><a class="reference external" href="classes/SBFile.html">SBFile</a></p></li>
<li><p><a class="reference external" href="interfaces/SBPayload.html">SBPayload</a></p></li>
</ul>
</section>
</section>
<section id="utilities-and-helpers">
<h2>Utilities and Helpers<a class="headerlink" href="#utilities-and-helpers" title="Permalink to this heading">#</a></h2>
<p>These are a set common operations, that typically are supported by the
web api, but where we want to ensure specific behavior.</p>
<ul class="simple">
<li><p><a class="reference external" href="classes/MessageBus.html">MessageBus</a></p></li>
</ul>
<ul class="simple">
<li><p>[arrayBuffer32ToBase62](modules.md#arraybuffer32tobase62)</p></li>
<li><p>[arrayBufferToBase64](modules.md#arraybuffertobase64)</p></li>
<li><p>[assemblePayload](modules.md#assemblepayload)</p></li>
<li><p>[base62ToArrayBuffer32](modules.md#base62toarraybuffer32)</p></li>
<li><p>[base62ToBase64](modules.md#base62tobase64)</p></li>
<li><p>[base64ToArrayBuffer](modules.md#base64toarraybuffer)</p></li>
<li><p>[base64ToBase62](modules.md#base64tobase62)</p></li>
<li><p>[decodeB64Url](modules.md#decodeb64url)</p></li>
<li><p>[encodeB64Url](modules.md#encodeb64url)</p></li>
<li><p>[encryptedContentsMakeBinary](modules.md#encryptedcontentsmakebinary)</p></li>
<li><p>[extractPayload](modules.md#extractpayload)</p></li>
<li><p>[getRandomValues](modules.md#getrandomvalues)</p></li>
<li><p>[jsonParseWrapper](modules.md#jsonparsewrapper)</p></li>
<li><p>[partition](modules.md#partition)</p></li>
<li><p>[simpleRand256](modules.md#simplerand256)</p></li>
<li><p>[simpleRandomString](modules.md#simplerandomstring)</p></li>
</ul>
<section id="crypto-class">
<h3>Crypto Class<a class="headerlink" href="#crypto-class" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="classes/SBCrypto.html">SBCrypto</a></p></li>
<li><p><a class="reference external" href="interfaces/EncryptedContents.html">EncryptedContents</a></p></li>
<li><p><a class="reference external" href="interfaces/EncryptedContentsBin.html">EncryptedContentsBin</a></p></li>
</ul>
</section>
<section id="crypto-helpers">
<h3>Crypto Helpers<a class="headerlink" href="#crypto-helpers" title="Permalink to this heading">#</a></h3>
</section>
<section id="sb-wire-format-helpers">
<h3>SB “Wire” Format Helpers<a class="headerlink" href="#sb-wire-format-helpers" title="Permalink to this heading">#</a></h3>
</section>
<section id="sb-specific-helpers">
<h3>SB-specific Helpers<a class="headerlink" href="#sb-specific-helpers" title="Permalink to this heading">#</a></h3>
</section>
<section id="testing-related">
<h3>Testing Related<a class="headerlink" href="#testing-related" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>[compareBuffers](modules.md#comparebuffers)</p></li>
</ul>
<hr class="docutils" />
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id4" role="note">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<p>(test) This is the closest to DM (Direct Message) that the system
allows, since one constraint is that any communication must
include a responsible Owner.</p>
</aside>
<aside class="footnote brackets" id="id5" role="note">
<span class="label"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></span>
<p>(test) If the whisper is initiated by the guest. If whisper is
initiated by the owner, the key derivation uses the private
half of &lt;room&gt;_ownerKey and the public key of the
guest. The derived key remains the same in both cases.</p>
</aside>
<aside class="footnote brackets" id="id6" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">3</a><span class="fn-bracket">]</span></span>
<p>(test) In exchange for possible weaker security, since now the
Owner needs to keep track of their key files.</p>
</aside>
</aside>
<hr class="docutils" />
</section>
</section>
<section id="dn-004-the-ready-pattern">
<span id="dn004"></span><h2>DN 004: The “Ready” Pattern<a class="headerlink" href="#dn-004-the-ready-pattern" title="Permalink to this heading">#</a></h2>
<p>Unfortunately we have lost the original source from where we first
heard about the “ready” design pattern, and that source might have
called it something different.</p>
<p>The idea is to allow objects to be created immediately, but not
necessarily be “ready” to use, meaning that there might be some
asynchronous initialization that needs to be completed before the
object is ready to use.</p>
<p>Here is essentially how it works:</p>
<blockquote>
<div><div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SomeClass</span><span class="p">()</span>
<span class="c1">// the object per se is created right away</span>

<span class="c1">// you can call any method on the object, but it will</span>
<span class="c1">// throw an exception if the object is not ready</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">someMethod</span><span class="p">()</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">readyFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="c1">// you can explicitly check if an object is ready</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="c1">// and if not, perhaps do something else</span>
<span class="p">}</span>

<span class="nx">obj</span><span class="p">.</span><span class="nx">ready</span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">obj</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="c1">// or you can set up what should be done when the object is ready</span>
<span class="p">})</span>
</pre></div>
</div>
</div></blockquote>
<p>That’s the basic model. Creating an object is not a blocking operation,
but you can check if it is ready or not, and if not, you can either
wait for it to become ready, or you can move on and do something else.
If you call a method on an object that is not ready, it will throw an
exception.</p>
<p>The “readyFlag” value is set to true when the object is ready, and the
“ready” promise is resolved when the object is ready. The “ready”
promise is initialized by the constructor, so you also can do this:</p>
<blockquote>
<div><div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">SomeClass</span><span class="p">()).</span><span class="nx">ready</span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">obj</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="c1">// do something with the object</span>
<span class="p">})</span>
</pre></div>
</div>
</div></blockquote>
<p>Internally (inside jslib), part of this pattern is done by the
ready decorator, allowing things like getters to be succinct:</p>
<blockquote>
<div><div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>@Ready get privateKey() { return this.#privateKey }
</pre></div>
</div>
</div></blockquote>
<p>This will automatically protect the getter from being called before
the internal state is ready, which in turn allows users of the library
to code more aggressively and not always have to explicitly
check if the object is ready or not.</p>
</section>
<section id="dn-005-browser-connectivity">
<span id="dn005"></span><h2>DN 005: Browser connectivity<a class="headerlink" href="#dn-005-browser-connectivity" title="Permalink to this heading">#</a></h2>
<p>Unfortunately, browsers at the time of writing (February, 2023)
simply do not have a good way of checking network status. Currently
it comes down to this:</p>
<ul class="simple">
<li><p>You cannot use ‘’XMLHttpRequest()’’ or ‘’fetch()’’ to “ping”
a server without it being noisy: for example, Chrome insists on
complaining (in red font) about ‘’ERR_CONNECTION_REFUSED’’ in the
developer console, no matter what you do in your javascript code.
The only way to turn that off is change default settings in the
browser developer tools setup.</p></li>
<li><p>You cannot use ‘’navigator.online’’ in all cases, because the
browser doesn’t consider a local server (on the same computer)
as a “server” per se, for this purpose, even though you can
connect to it.</p></li>
</ul>
<p>The current net-net of this situation is that we chose not to
make jslib “proactive”, or “smart”, in this context. What we
can do, however, is “track” any of these errors, and print out
an info message on the console to ignore ‘’ERR_CONNECTION_REFUSED’’.</p>
<p>It would be nice if there was a simple api to check connectivity
to a server or an IP address. But it’s not something to be too
upset about: we’re pushing the browser behavior here pretty far
already. But it does mean that systems like Deno or Cloudflare’s
‘’workerd’’ will have to have additional non-browser APIs, just
like node needed … and then presumably browsers will add
incompatible versions of those …</p>
</section>
<section id="dn-006-localhost-cors-and-other-fun-things">
<h2>DN 006: Localhost, CORS, and other fun things<a class="headerlink" href="#dn-006-localhost-cors-and-other-fun-things" title="Permalink to this heading">#</a></h2>
<p>The browser has a concept of “same origin” policy, which means that
a web page can only access resources on the same server, or on a
different server, but only if the server explicitly allows it.</p>
<p>This plus some other issues adds up to these constraints:</p>
<ul class="simple">
<li><p>If you want a static (local) web page, e.g. a resource of type
“<a class="reference external" href="file://">file://</a>”, then it CANNOT load other resources locally - such as
a library (eg jslib itself). This is a security feature of the
browser, and it’s not likely to change.</p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="modules.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">JSLib Reference Manual</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="license.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">LICENSE</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2019-2023, Magnusson Institute
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">JSLib User Manual</a><ul>
<li><a class="reference internal" href="#installation-development">Installation / Development</a></li>
<li><a class="reference internal" href="#sb384">SB384</a></li>
<li><a class="reference internal" href="#snackabra-server-class">Snackabra (Server) Class</a><ul>
<li><a class="reference internal" href="#sb-message-class">SB Message Class</a></li>
<li><a class="reference internal" href="#channels">Channels</a></li>
<li><a class="reference internal" href="#storage">Storage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#utilities-and-helpers">Utilities and Helpers</a><ul>
<li><a class="reference internal" href="#crypto-class">Crypto Class</a></li>
<li><a class="reference internal" href="#crypto-helpers">Crypto Helpers</a></li>
<li><a class="reference internal" href="#sb-wire-format-helpers">SB “Wire” Format Helpers</a></li>
<li><a class="reference internal" href="#sb-specific-helpers">SB-specific Helpers</a></li>
<li><a class="reference internal" href="#testing-related">Testing Related</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dn-004-the-ready-pattern">DN 004: The “Ready” Pattern</a></li>
<li><a class="reference internal" href="#dn-005-browser-connectivity">DN 005: Browser connectivity</a></li>
<li><a class="reference internal" href="#dn-006-localhost-cors-and-other-fun-things">DN 006: Localhost, CORS, and other fun things</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    </body>
</html>