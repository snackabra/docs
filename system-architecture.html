<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Background and Discussion" href="discussion.html" /><link rel="prev" title="Technical Overview" href="overview.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>System Architecture - snackabra 0.5.x beta documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">snackabra 0.5.x beta documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">snackabra 0.5.x beta documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Technical Overview</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">System Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="discussion.html">Background and Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="formal.html">Formal Treatment</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact and Feedback</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="future.html">Future Work</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References / Further Reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">LICENSE</a></li>
<li class="toctree-l1"><a class="reference internal" href="jslib.html">SB JSLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Snackabra Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="pylib.html">Python Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-a-crypto.html">Appendix A: Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-guide.html">Appendix B: Privacy.App Chat Room User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="diag-sample.html">(ignore)</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="system-architecture">
<h1>System Architecture<a class="headerlink" href="#system-architecture" title="Permalink to this heading">#</a></h1>
<p>To both future-proof as well as take advantage of what we’ve learned
over the past 10-20 years in the area of <em>implementing and *operating</em>
a messaging and document sharing service. To give a full accounting of
the background to the following considerations is beyond the scope;
here we will only provide a summary of experiences feeding into
these. Hence, the following includes blanket assertions without citing
backing references; we’re happy to discuss and debate any or all of
these in separate communications.</p>
<p>This section will include only cursory explanations of any major
concepts of modern (internet) system architectures; we will try to use
the “correct” (most widely used) names for any technologies or
architecture decisions, to facilitate for a reader to inform
themselves elsewhere.</p>
<section id="computing">
<span id="id1"></span><h2>Computing<a class="headerlink" href="#computing" title="Permalink to this heading">#</a></h2>
<p>We have clients and backend(s). For clients our baseline is simply a
modern web browser. The core of the client chat application is
Javascript. <a class="footnote-reference brackets" href="#f151" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> The communication with backends is over
asynchronous HTTPS and WebSockets. The entry (“landing page”) backend
delivers a single-page web app (‘SPA’) after which it operates an
asynchronous API.</p>
<p>For backend computing, we’re targeting light-weight edge <a href="#id16"><span class="problematic" id="id3">[#152]_</span></a>
computing as the most modern approach, sometimes referred to as
“edge-native.”  We will assume this to be in the form of minimalist
Javascript containers implementing a subset of the standard web
API. <a href="#id17"><span class="problematic" id="id4">[#153]_</span></a> As these are a variation of the (old) general concept of
“computational node,” we will refer to them as “worker nodes”, or
“workers” for short.</p>
<p>We will further assume these workers come in two flavors:
<a class="reference internal" href="glossary.html#term-addressable-worker"><span class="xref std std-term">addressable worker</span></a> and <a class="reference internal" href="glossary.html#term-non-addressable-worker"><span class="xref std std-term">non-addressable worker</span></a>:</p>
<ul>
<li><p>Non-addressable workers are the “conventional” form of “PaaS” cloud
computing, brought to the edge. <a href="#id18"><span class="problematic" id="id5">[#154]_</span></a> They can be reached over the
network (obviously) but only in a <em>general</em> sense: when the client
connects to “chat.example.com”, it ends up connecting to <em>some</em>
container that loads on <em>some</em> server, with the same container code
every time. The underlying infrastructure can scale up and down the
number of servers it needs to run the number of containers needed to
serve the number of (and load from) clients. <a href="#id19"><span class="problematic" id="id6">[#155]_</span></a>
Furthermore, a non-addressable worker does not have local storage;
any state needed is accessed from a separate (<a class="reference internal" href="glossary.html#term-KV_global"><span class="xref std std-term">KV_global</span></a>) service such
as a key-value store API.</p></li>
<li><p>A non-addressable worker does not have an addressable global
identity: a client has no control over what specific container or
server it connects to. In contrast, an addressable worker is a
specific instance of a worker, and all clients requesting <em>that</em>
worker will all get to the same one instance. If no instance is
running, the infrastructure will start one, and handle any data race
or location issues transparently. In this manner, an addressable
worker can have ‘local’ storage (in addition to ‘global’), since it
doesn’t move (at least not as much). We refer to this as
<a class="reference internal" href="glossary.html#term-KV_local"><span class="xref std std-term">KV_local</span></a> (not to be confused with the <em>client</em> <a class="reference internal" href="glossary.html#term-Local-Storage"><span class="xref std std-term">Local Storage</span></a>).
With local worker storage now</p>
<p>possible, an addressable worker can now provide storage with both
stronger consistency models and higher performance, since there is
now a ‘locality’. Furthermore, an addressable worker can offer
real-time interfaces for a group of clients. We will assume and take
advantage of both of these benefits, specifically we will assume
that clients can connect to an addressable worker with websockets.</p>
</li>
</ul>
<p>The chat system is implemented using a mixture of addressable and
non-addressable workers - typically any direct participation in a
“room” (rooms are introduced below) is done through a websocket to an
addressable worker, and any API calls that either can tolerate
asynchronicity and/or do not have strong consistency requirements are
directed at non-addressable workers</p>
<p>Furthermore, several administrative functions are done elsewhere, in
two forms: an online identity provider (IDP) that we refer to as the
“SSO”, and offline functions we refer to as “CLI”. The design attempts
to leave as little information and vulnerability as possible in the
SSO. The CLI is assumed to be offline (gap aired) when not actively
used for specific purposes; furthermore we strive for these to be
“batch” oriented as much as possible.</p>
</section>
<section id="storage">
<span id="id7"></span><h2>Storage<a class="headerlink" href="#storage" title="Permalink to this heading">#</a></h2>
<p>For storage we will assume both global and local key-value storage. We
will make minimum assumptions on features; for searches we will only
need “prefix” storage queries. <a href="#id20"><span class="problematic" id="id8">[#156]_</span></a> We will also assume that
the value can either be a string or a binary object. <a href="#id21"><span class="problematic" id="id9">[#157]_</span></a></p>
<p>The global key-value storage system we will refer to as <a class="reference internal" href="glossary.html#term-KV_global"><span class="xref std std-term">KV_global</span></a>,
and the local (for an addressable worker, see above) as <a class="reference internal" href="glossary.html#term-KV_local"><span class="xref std std-term">KV_local</span></a>:</p>
<ul class="simple">
<li><p>We will aim to design for high tolerance of loose memory coherency
in <a class="reference internal" href="glossary.html#term-KV_global"><span class="xref std std-term">KV_global</span></a>, including eventual consistency. The size limits of
individual values will (currently) determine the largest document
that can be shared. <a href="#id22"><span class="problematic" id="id10">[#158]_</span></a></p></li>
<li><p>We will require a fairly strict consistency model for
<a class="reference internal" href="glossary.html#term-KV_local"><span class="xref std std-term">KV_local</span></a>. The design can handle value size limits down to 32KB.</p></li>
</ul>
<p>We will design our keys to be friendly towards any hashing
mechanism. Reading a specific item in a KV system can generally be
done in constant time; choice of only requiring a prefix search is
that this can also be implemented in constant time <a href="#id23"><span class="problematic" id="id11">[#159]_</span></a>, allowing the design to scale
arbitrarily.</p>
<p>Finally, (browser) clients require use of <strong>local_storage</strong>, <a href="#id24"><span class="problematic" id="id12">[#160]_</span></a>
if that is unreliable, that user needs to export/import to a local
file system (local to their computer/device).</p>
</section>
<section id="cloudflare">
<span id="id13"></span><h2>Cloudflare<a class="headerlink" href="#cloudflare" title="Permalink to this heading">#</a></h2>
<p>Our reference implementation is primarily built on Cloudflare
products, and should be relatively easy to self-host. The reason is
that, from what we can tell, Cloudflare currently has the simplest to
use implementation of the next-generation “best practices” that we
outline above. To the extent any of this is unique to Cloudflare, we
would not expect that to remain the case.</p>
<ul>
<li><p>Their edge computing solution (“Cloudflare Workers”) is the
“correct” approach of best practice cloud computing today, namely, a
language-native smallest possible container with dynamic (native)
code generation interpreter. In the case of Javascript, the v8
(Google Chrome) language virtual machine has a concept of an
<em>Isolate</em>, which implements full JS interpreter isolation (with
separate heap, garbage collector, etc). This gives it a <em>tiny</em>
memory footprint (and close to instant startup times). With native
hardware x86-64 support in the v8 runtime dynamic code-generating
compiler, it’s also high-performance in code execution. We use
Cloudflare Workers for “<strong>workers</strong>.”</p>
<ul>
<li><p>“Introducing Cloudflare Workers”
<a class="reference external" href="https://blog.cloudflare.com/introducing-cloudflare-workers">https://blog.cloudflare.com/introducing-cloudflare-workers</a></p></li>
<li><p>“Cloud Computing without Containers”
<a class="reference external" href="https://blog.cloudflare.com/cloud-computing-without-containers">https://blog.cloudflare.com/cloud-computing-without-containers</a></p>
<p>More detailed presentation by Kenton Varda:
<a class="reference external" href="https://www.infoq.com/presentations/cloudflare-v8">https://www.infoq.com/presentations/cloudflare-v8</a></p>
<p>Some in-depth internals that walks through implementation details of internals:
<a class="reference external" href="https://v8.dev/docs/embed">https://v8.dev/docs/embed</a>
<a class="reference external" href="https://v8.dev/blog/embedded-builtins">https://v8.dev/blog/embedded-builtins</a>
<a class="reference external" href="https://www.youtube.com/watch?v=lqE4u8s8Iik">https://www.youtube.com/watch?v=lqE4u8s8Iik</a></p>
</li>
</ul>
</li>
<li><p>Cloudflare recently introduced “Unique Durable Objects”, or “Durable
Object Workers” (<a class="reference internal" href="glossary.html#term-Durable-Object"><span class="xref std std-term">Durable Object</span></a>). These correspond to what we above call
“<em>addressable workers</em>” including both strong (transactional)
consistency in their <a class="reference internal" href="glossary.html#term-KV_local"><span class="xref std std-term">KV_local</span></a> storage, as well as support for
websockets. <a href="#id25"><span class="problematic" id="id14">[#161]_</span></a>  (Out of habit we
will sometimes refer to this as <a class="reference internal" href="glossary.html#term-Durable-Object"><span class="xref std std-term">Durable Object</span></a>.)</p></li>
<li><p>Workers Durable Objects Beta: A New Approach to Stateful Serverless
<a class="reference external" href="https://blog.cloudflare.com/introducing-workers-durable-objects">https://blog.cloudflare.com/introducing-workers-durable-objects</a>
Durable Objects: Easy, Fast, Correct — Choose three
<a class="reference external" href="https://blog.cloudflare.com/durable-objects-easy-fast-correct-choose-three">https://blog.cloudflare.com/durable-objects-easy-fast-correct-choose-three</a></p></li>
<li><p>Cloudflare workers have easy access to their KV system, <a class="reference internal" href="glossary.html#term-KV_global"><span class="xref std std-term">KV_global</span></a>.
<a class="reference external" href="https://developers.cloudflare.com/workers/runtime-apis/kv">https://developers.cloudflare.com/workers/runtime-apis/kv</a></p></li>
</ul>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f02" role="note">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<p>Concept of “Owner” is explained <a class="reference internal" href="overview.html#owner-definition"><span class="std std-ref">here</span></a>.</p>
</aside>
<aside class="footnote brackets" id="f151" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>In our case we are using React Native for the UI, but the
core of the client-side MiChat code will be a Javascript
library that can be added to various contexts, including a
minimalist (static, local) html file.</p>
</aside>
<aside class="footnote brackets" id="f152" role="note">
<span class="label"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></span>
<p>As opposed to ‘cloud computing’ which was the preceding
generation of architecture.</p>
</aside>
<aside class="footnote brackets" id="f153" role="note">
<span class="label"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></span>
<p>In this context, something like a Docker image is, in fact,
Heavy. We assume a subset since that’s the smart thing to
do: full api support starts getting heavy.</p>
</aside>
<aside class="footnote brackets" id="f154" role="note">
<span class="label"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></span>
<p>Edge computing is where the backend/server code is running
inside, or very near, the network: for example in an
Internet Exchange Point or even on a Mobile Base
Station. It would include any computing platform that the
operator of the chat service considers trusted. Thus, for
example, it would probably not include a consumer home
router, unless the instance of the service was operated by
its owner. See also <a class="reference internal" href="discussion.html#micro-federation"><span class="std std-ref">micro-federation</span></a></p>
</aside>
<aside class="footnote brackets" id="f155" role="note">
<span class="label"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></span>
<p>The textbook pioneer of this model was Google App Engine,
though their initial choice for container language was
Python. By having a standardized language and API, the
exact same lightweight container can be used for all
customers and all applications, with dramatic benefits.</p>
</aside>
<aside class="footnote brackets" id="f156" role="note">
<span class="label"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></span>
<p>The core concept of key-value store (also called ‘key-value
database’) is a generic ‘key’ which then maps to some
object (value). It’s akin to a hash table. By having a flat
addressing scheme and no metadata (in its simplest form),
it can be made both scalable, reliable, and fast.</p>
</aside>
<aside class="footnote brackets" id="f157" role="note">
<span class="label"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></span>
<p>We will manage multi-part objects ourselves, see ‘wire
protocol’ below.</p>
</aside>
<aside class="footnote brackets" id="f158" role="note">
<span class="label"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></span>
<p>In the case of images, the client code will down-sample /
reduce the image size until it fits into 80% of the limit
(which currently translates to 20MB image/photo size
max). It will only store unmodified image (with metadata)
if that fits into 20MB (binary).</p>
</aside>
<aside class="footnote brackets" id="f159" role="note">
<span class="label"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></span>
<p>Technically O(m) where ‘m’ is the length of the prefix. So
we should note that the design will only ever perform
fixed-length / bounded prefix queries; in current
implementation &lt;64 bytes.</p>
</aside>
<aside class="footnote brackets" id="f160" role="note">
<span class="label"><span class="fn-bracket">[</span>11<span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage/local">https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage/local</a></p>
</aside>
<aside class="footnote brackets" id="f161" role="note">
<span class="label"><span class="fn-bracket">[</span>12<span class="fn-bracket">]</span></span>
<p>Not surprisingly, Cloudflare anticipated that chat rooms
would be an excellent use case:
<a class="reference external" href="https://github.com/cloudflare/workers-chat-demo">https://github.com/cloudflare/workers-chat-demo</a></p>
</aside>
</aside>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="discussion.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Background and Discussion</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="overview.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Technical Overview</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2019-2023, Magnusson Institute
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">System Architecture</a><ul>
<li><a class="reference internal" href="#computing">Computing</a></li>
<li><a class="reference internal" href="#storage">Storage</a></li>
<li><a class="reference internal" href="#cloudflare">Cloudflare</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    </body>
</html>